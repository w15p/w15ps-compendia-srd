{"name":"Booming Blade","type":"spell","img":"icons/skills/melee/strike-sword-slashing-red.webp","system":{"description":{"value":"","chat":"","unidentified":""},"source":"","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"1","units":"round"},"cover":null,"target":{"value":null,"width":null,"units":"","type":"enemy"},"range":{"value":null,"long":null,"units":""},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":0,"school":"evo","components":{"vocal":false,"somatic":true,"material":true,"ritual":false,"concentration":false},"materials":{"value":"a melee weapon worth 1sp or more","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"always","prepared":true},"scaling":{"mode":"none","formula":""}},"effects":[],"ownership":{"default":0,"MaCLnRgHzMpMdp8c":3},"flags":{"midi-qol":{"effectActivation":false,"onUseMacroName":"[preItemRoll]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"autoFailFriendly":false,"autoSaveFriendly":false,"rollOther":false,"critOther":false,"offHandWeapon":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false},"itemacro":{"macro":{"name":"Booming Blade","type":"script","scope":"global","command":"// very minor modifications of MrPrimate's excellent boomingBlade.js from ddb-importer\n// https://github.com/MrPrimate/ddb-importer/blob/main/macros/spells/boomingBlade.js\n/////\n\nconst lastArg = args[args.length - 1];\n\n// handle targeting because the spell's Target option was creating multiple attacks\n// and not handling the 5ft range properly\nif (lastArg.tag === \"OnUse\") {\n  const actorToken = await fromUuid(lastArg.tokenUuid);\n  const targetToken = lastArg.targets[0];\n\n  // debug\n  /*\n  console.log(lastArg);\n  console.log(actorToken);\n  console.log(targetToken);\n  console.log(\"MidiQol.getDistance: \" + MidiQOL.getDistance(actorToken, targetToken, true))\n  */\n\n  if (lastArg.targets.length == 1) {\n    if (MidiQOL.getDistance(actorToken, targetToken, true) > 5) {\n      ui.notifications.error(\"Booming Blade: Target is too far away. Please select one target within 5ft and try again.\");\n      return;\n    }\n  } else if (lastArg.targets.length > 1) {\n    ui.notifications.error(\"Booming Blade: More than one target selected. Please select one target and try again.\");\n    return;\n  } else if (lastArg.targets.length == 0) { // late targeting handles this fine...\n    ui.notifications.error(\"Booming Blade: No target selected. Please select one target and try again.\");\n    return;\n  }\n}\n\n// macro vars\nconst sequencerFile = \"jb2a.static_electricity.01.blue\";\nconst sequencerScale = 1.5;\nconst damageType = \"thunder\";\n\n// sequencer caller for effects on target\nfunction sequencerEffect(target, file, scale) {\n  if (game.modules.get(\"sequencer\")?.active && hasProperty(Sequencer.Database.entries, \"jb2a\")) {\n    new Sequence().effect().file(file).atLocation(target).scaleToObject(scale).play();\n  }\n}\n\nfunction weaponAttack(caster, sourceItemData, origin, target) {\n  const chosenWeapon = DAE.getFlag(caster, \"boomingBladeChoice\");\n  const filteredWeapons = caster.items.filter((i) => i.type === \"weapon\" && i.system.equipped);\n  const weaponContent = filteredWeapons\n    .map((w) => {\n      const selected = chosenWeapon && chosenWeapon == w.id ? \" selected\" : \"\";\n      return `<option value=\"${w.id}\"${selected}>${w.name}</option>`;\n    })\n    .join(\"\");\n\n  const content = `\n<div class=\"form-group\">\n <label>Weapons : </label>\n <select name=\"weapons\"}>\n ${weaponContent}\n </select>\n</div>\n`;\n  new Dialog({\n    title: \"Booming Blade: Choose a weapon to attack with\",\n    content,\n    buttons: {\n      Ok: {\n        label: \"Ok\",\n        callback: async (html) => {\n          const characterLevel = caster.type === \"character\" ? caster.system.details.level : caster.system.details.cr;\n          const cantripDice = 1 + Math.floor((characterLevel + 1) / 6);\n          const itemId = html.find(\"[name=weapons]\")[0].value;\n          const weaponItem = caster.getEmbeddedDocument(\"Item\", itemId);\n          DAE.setFlag(caster, \"boomingBladeChoice\", itemId);\n          const weaponCopy = duplicate(weaponItem);\n          delete weaponCopy._id;\n          if (cantripDice > 0) {\n            weaponCopy.system.damage.parts[0][0] += ` + ${cantripDice - 1}d8[${damageType}]`;\n          }\n          weaponCopy.name = weaponItem.name + \" [Booming Blade]\";\n          weaponCopy.effects.push({\n            changes: [{ key: \"macro.itemMacro\", mode: 0, value: \"\", priority: \"20\", }],\n            disabled: false,\n            duration: { rounds: 1 },\n            icon: sourceItemData.img,\n            label: sourceItemData.name,\n            origin,\n            transfer: false,\n            flags: { targetUuid: target.uuid, casterUuid: caster.uuid, origin, cantripDice, damageType, dae: { specialDuration: [\"turnStartSource\", \"isMoved\"], transfer: false } },\n          });\n          setProperty(weaponCopy, \"flags.itemacro\", duplicate(sourceItemData.flags.itemacro));\n          setProperty(weaponCopy, \"flags.midi-qol.effectActivation\", false);\n          const attackItem = new CONFIG.Item.documentClass(weaponCopy, { parent: caster });\n          const options = { showFullCard: false, createWorkflow: true, configureDialog: true };\n          await MidiQOL.completeItemRoll(attackItem, options);\n        },\n      },\n      Cancel: {\n        label: \"Cancel\",\n      },\n    },\n  }).render(true);\n}\n\nif (args[0].tag === \"OnUse\") {\n  if (lastArg.targets.length > 0) {\n    const casterData = await fromUuid(lastArg.actorUuid);\n    const caster = casterData.actor ? casterData.actor : casterData;\n    weaponAttack(caster, lastArg.itemData, lastArg.uuid, lastArg.targets[0]);\n  } else {\n    ui.notifications.error(\"Booming Blade: No target selected: please select a target and try again.\");\n  }\n  \n} else if (args[0] === \"on\") {\n  const targetToken = canvas.tokens.get(lastArg.tokenId);\n  sequencerEffect(targetToken, sequencerFile, sequencerScale);\n  \n} else if (args[0] === \"off\") {\n  // uses midis move flag to determine if to apply extra damage\n  if (lastArg[\"expiry-reason\"] === \"midi-qol:isMoved\" || lastArg[\"expiry-reaason\"] === \"midi-qol:isMoved\") {\n    const targetToken = await fromUuid(lastArg.tokenUuid);\n    const sourceItem = await fromUuid(lastArg.efData.flags.origin);\n    const caster = sourceItem.parent;\n    const casterToken = canvas.tokens.placeables.find((t) => t.actor?.uuid === caster.uuid);\n    const damageRoll = await new Roll(`${lastArg.efData.flags.cantripDice}d8[${damageType}]`).evaluate({ async: true });\n    if (game.dice3d) game.dice3d.showForRoll(damageRoll);\n    const workflowItemData = duplicate(sourceItem.data);\n    workflowItemData.system.target = { value: 1, units: \"\", type: \"creature\" };\n    workflowItemData.name = \"Booming Blade: Movement Damage\";\n\n    await new MidiQOL.DamageOnlyWorkflow(\n      caster,\n      casterToken,\n      damageRoll.total,\n      damageType,\n      [targetToken.object], // bug in midi/levels auto cover can't cope with token\n      damageRoll,\n      {\n        flavor: `(${CONFIG.DND5E.damageTypes[damageType]})`,\n        itemCardId: \"new\",\n        itemData: workflowItemData,\n        isCritical: false,\n      }\n    );\n    sequencerEffect(targetToken, sequencerFile, sequencerScale);\n  }\n}","author":"MaCLnRgHzMpMdp8c","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"core":{"sourceId":"Item.nqMUq7alEmN5Eo6F"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1679938612764,"modifiedTime":1680036851576,"lastModifiedBy":"MaCLnRgHzMpMdp8c"},"folder":null,"sort":0,"_id":"C3AAAtcVdSqNi03m"}
{"name":"Magic Missile","type":"spell","system":{"description":{"value":"<div class=\"rd__b  rd__b--3\"><p>You create three glowing darts of magical force. Each dart hits a creature of your choice that you can see within range. A dart deals [[/r 1d4 + 1]] force damage to its target. The darts all strike simultaneously, and you can direct them to hit one creature or several.</p><div class=\"rd__spc-inline-post\"></div></div><div class=\"rd__b  rd__b--3\"><div class=\"rd__b  rd__b--3\"><span class=\"rd__h rd__h--3\" data-title-index=\"1\"> <span class=\"entry-title-inner\">At Higher Levels.</span></span> <p>When you cast this spell using a spell slot of 2nd level or higher, the spell creates one more dart for each slot level above 1st.</p><div class=\"rd__spc-inline-post\"></div></div><div class=\"rd__spc-inline-post\"></div></div>","chat":"","unidentified":""},"source":"SRD 5.1","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"","units":"inst"},"cover":null,"target":{"value":null,"width":null,"units":"","type":"creature"},"range":{"value":120,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["1d4 + 1","force"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"evo","components":{"vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""}},"img":"icons/magic/light/projectile-stars-blue.webp","flags":{"grimoire":{"page":"spells.html","source":"PHB","hash":"magic%20missile_phb","propDroppable":"spell"},"scene-packer":{"hash":"66807707298156be4fff1f7a1ed535033a2c1bc5"},"midi-qol":{"effectActivation":false,"onUseMacroName":"[preDamageApplication]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"autoFailFriendly":false,"autoSaveFriendly":false,"rollOther":false,"critOther":false,"offHandWeapon":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false},"itemacro":{"macro":{"name":"Magic Missile","type":"script","scope":"global","command":"W15ps.MagicMissile.cast(args[0].workflow);","author":"MaCLnRgHzMpMdp8c","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"core":{"sourceId":"Actor.MEqNb3Gybxr8PdoX.Item.wsCw41ZnIE0PPbCi"}},"effects":[],"ownership":{"default":0,"MaCLnRgHzMpMdp8c":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1675798407388,"modifiedTime":1680109427182,"lastModifiedBy":"MaCLnRgHzMpMdp8c"},"folder":null,"sort":0,"_id":"S3aOcZU4moKLr8Vi"}
{"name":"Faerie Fire","type":"spell","system":{"description":{"value":"<div class=\"rd__b  rd__b--3\"><p>Each object in a 20-foot cube within range is outlined in blue, green, or violet light (your choice). Any creature in the area when the spell is cast is also outlined in light if it fails a Dexterity saving throw. For the duration, objects and affected creatures shed dim light in a 10-foot radius.</p><div class=\"rd__spc-inline-post\"></div><p>Any attack roll against an affected creature or object has advantage if the attacker can see it, and the affected creature or object can't benefit from being @condition[invisible].</p></div>","chat":"","unidentified":""},"source":"SRD 5.1","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"1","units":"minute"},"cover":null,"target":{"value":20,"width":null,"units":"ft","type":"cube"},"range":{"value":60,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"dex","dc":null,"scaling":"spell"},"level":1,"school":"evo","components":{"vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"pact","prepared":true},"scaling":{"mode":"none","formula":""}},"img":"icons/magic/light/explosion-star-glow-silhouette.webp","flags":{"grimoire":{"page":"spells.html","source":"PHB","hash":"faerie%20fire_phb","propDroppable":"spell"},"rsr5e":{"quickOther":{"context":""},"quickDesc":{"value":true},"quickFooter":{"value":true},"quickSave":{"value":true}},"midi-qol":{"effectActivation":false,"forceCEOff":true,"onUseMacroName":""},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"autoFailFriendly":false,"autoSaveFriendly":false,"rollOther":false,"critOther":false,"offHandWeapon":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false},"itemacro":{"macro":{"name":"Faerie Fire","type":"script","scope":"global","command":"if(args[0] === \"on\") {\n    let lastPlaced = canvas.templates.placeables.at(-1);\n    if (lastPlaced && lastPlaced.document) {\n        lastPlaced.document.delete();\n    }\n}","author":"MaCLnRgHzMpMdp8c","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"core":{"sourceId":"Actor.mP9COHvMJYRe2VTl.Item.7eE7I1QUFoovAV0h"}},"effects":[{"label":"Faerie Fire","icon":"icons/magic/light/explosion-star-glow-silhouette.webp","origin":"Actor.mP9COHvMJYRe2VTl.Item.7eE7I1QUFoovAV0h","duration":{"seconds":60,"startTime":null,"combat":null,"rounds":10,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"Uc9AxrmxRCL8PALc","changes":[{"key":"flags.midi-qol.grants.advantage.attack.all","mode":0,"value":"1","priority":0},{"key":"macro.tokenMagic","mode":0,"value":"Faerie Fire","priority":0}],"tint":null,"transfer":false,"flags":{"dfreds-convenient-effects":{"description":""},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""}}}],"ownership":{"default":0,"4gYGycP9xCk5mwC0":3,"MaCLnRgHzMpMdp8c":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1673305588607,"modifiedTime":1680036722697,"lastModifiedBy":"MaCLnRgHzMpMdp8c"},"folder":null,"sort":0,"_id":"XW3Ounvix9V3zZfT"}
